<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Client</title>
    <link rel="stylesheet" href="wss.css">
</head>
<body>
<script>
    const socket = new WebSocket('ws://localhost:8080/ws/json');

    socket.onopen = function(e) {
        console.log('Connection established');
    };

    socket.onmessage = function(event) {
        const message = JSON.parse(event.data);
        console.log('Received:', message);
    };

    socket.onclose = function(event) {
        if (event.wasClean) {
            console.log(`Connection closed cleanly, code=${event.code}, reason=${event.reason}`);
        } else {
            console.log('Connection died');
        }
    };

    socket.onerror = function(error) {
        console.log(`WebSocket error: ${error.message}`);
    };

    function sendMessage() {
        const message = {
            type: 'REQUEST',
            content: document.getElementById('messageContent').value.trim(),
            sender: window.sessionSenderId || (window.sessionSenderId = 'browser-' + Math.random().toString(36).substring(2, 10))
        };
        if (message.content === '') {
            alert('Message cannot be empty');
            return;
        }
        console.log('Sending:', message);
        socket.send(JSON.stringify(message));

        // Show toast notification
        const toast = document.createElement('div');
        toast.textContent = 'Message sent!';
        toast.className = 'toast';
        document.body.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 2000);

        // Reset textarea
        document.getElementById('messageContent').value = '';
    }
</script>
<textarea id="messageContent" rows="10" cols="100" placeholder="Type your message here"></textarea><br>
<button class="send-btn" onclick="sendMessage()">Send Message</button>
</body>
</html>